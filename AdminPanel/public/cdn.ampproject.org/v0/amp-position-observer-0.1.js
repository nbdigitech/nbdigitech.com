(self.AMP=self.AMP||[]).push({n:"amp-position-observer",v:"1902081532110",f:(function(AMP,_){
var h="function"==typeof Object.create?Object.create:function(a){function b(){}b.prototype=a;return new b},l;if("function"==typeof Object.setPrototypeOf)l=Object.setPrototypeOf;else{var m;a:{var p={a:!0},q={};try{q.__proto__=p;m=q.a;break a}catch(a){}m=!1}l=m?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null}var r=l;self.log=self.log||{user:null,dev:null,userForEmbed:null};var t=self.log;function u(){if(!t.user)throw Error("failed to call initLogConstructor");return t.user}function v(a,b,d){return u().assert(a,b,d,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0)};function w(a){var b,d=a.ownerDocument.defaultView,c=d!=(d.__AMP_TOP||d);if(c){if(x(d,"action")){var e=y(d,"action");if(e)return e}if(!b)return null}a=z(a);a=A(a);return x(a,"action")?y(a,"action"):null}function B(a,b){var d=z(a),c=A(d),e=c,g=C(e),f=g["position-observer"];f||(f=g["position-observer"]={obj:null,promise:null,resolve:null,context:null,ctor:null});f.ctor||f.obj||(f.ctor=b,f.context=d,f.resolve&&y(e,"position-observer"))}function D(a,b){a=a.__AMP_TOP||a;return y(a,b)}
function E(a,b){var d=z(a);d=A(d);return y(d,b)}function z(a){return a.nodeType?D((a.ownerDocument||a).defaultView,"ampdoc").getAmpDoc(a):a}function A(a){a=z(a);return a.isSingleDoc()?a.win:a}function y(a,b){x(a,b);var d=C(a);a=d[b];a.obj||(a.obj=new a.ctor(a.context),a.ctor=null,a.context=null,a.resolve&&a.resolve(a.obj));return a.obj}function C(a){var b=a.services;b||(b=a.services={});return b}function x(a,b){a=a.services&&a.services[b];return!(!a||!a.ctor&&!a.obj)};/*
 https://mths.be/cssescape v1.5.1 by @mathias | MIT license */
function F(a){return a||{}};function G(a,b,d,c){return{left:a,top:b,width:d,height:c,bottom:b+c,right:a+d,x:a,y:b}}function H(a,b){return a.top<b.top?"top":a.bottom>b.bottom?"bottom":"inside"}function I(a,b){return a&&b?a.left==b.left&&a.top==b.top&&a.width==b.width&&a.height==b.height:!1};function J(a,b,d,c){this.element=b;this.O=c;this.fidelity=d;this.turn=0==d?Math.floor(4*Math.random()):0;this.B=null;this.o=E(a,"viewport")}
J.prototype.update=function(a){var b=this;if(!a){if(0!=this.turn){this.turn--;return}0==this.fidelity&&(this.turn=4)}var d=this.o.getSize(),c=G(0,0,d.width,d.height);this.o.getClientRectAsync(this.element).then(function(a){var d={positionRect:a,viewportRect:c,relativePos:""},f=b.B;if(!(f&&I(f.positionRect,d.positionRect)&&I(f.viewportRect,d.viewportRect))){f=d.positionRect;d.relativePos=H(f,d.viewportRect);var e=d.viewportRect;f.top<=e.bottom&&e.top<=f.bottom&&f.left<=e.right&&e.left<=f.right?(b.B=
d,b.O(d)):b.B&&(b.B=null,d.positionRect=null,b.O(d))}})};function K(a){v(/^\d+(\.\d+)?(px|em|rem|vh|vw|vmin|vmax|cm|mm|q|in|pc|pt)$/.test(a),"Invalid length value: %s",a);return a};function L(a,b,d){var c={detail:d};Object.assign(c,void 0);if("function"==typeof a.CustomEvent)return new a.CustomEvent(b,c);a=a.document.createEvent("CustomEvent");a.initCustomEvent(b,!!c.bubbles,!!c.cancelable,d);return a};function M(a,b){function d(){c=0;var f=500-(a.Date.now()-e);if(0<f)c=a.setTimeout(d,f);else{var n=g;g=null;b.apply(null,n)}}var c=0,e=0,g=null;return function(b){for(var f=[],k=0;k<arguments.length;++k)f[k-0]=arguments[k];e=a.Date.now();g=f;c||(c=a.setTimeout(d,500))}};function N(a){var b=this;this.T=a;this.S=a.win;this.c=[];this.X=D(this.S,"vsync");this.o=E(a,"viewport");this.F=[];this.I=this.K=this.J=!1;this.U=M(this.S,function(){b.J=!1})}N.prototype.observe=function(a,b,d){var c=this,e=new J(this.T,a,b,d);this.c.push(e);this.I||O(this);e.update();return function(){for(var a=0;a<c.c.length;a++)if(c.c[a]==e){c.c.splice(a,1);0==c.c.length&&P(c);break}}};
N.prototype.unobserve=function(a){for(var b=0;b<this.c.length;b++)if(this.c[b].element==a){this.c.splice(b,1);0==this.c.length&&P(this);return}if(t.dev)a=t.dev;else throw Error("failed to call initLogConstructor");a.error("POSITION_OBSERVER","cannot unobserve unobserved element")};function O(a){a.I=!0;a.F.push(a.o.onScroll(function(){a.U();a.J=!0;a.K||Q(a)}));a.F.push(a.o.onResize(function(){a.updateAllEntries(!0)}))}function P(a){for(a.I=!1;a.F.length;)a.F.pop()()}
N.prototype.updateAllEntries=function(a){for(var b=0;b<this.c.length;b++)this.c[b].update(a)};function Q(a){a.updateAllEntries();a.K=!0;a.J?a.X.measure(function(){Q(a)}):a.K=!1}function R(a){B(a,function(){return new N(a)})};function S(a){a=AMP.BaseElement.call(this,a)||this;a.w=null;a.h=!1;a.l=null;a.m=0;a.j=0;a.M="0";a.H="0";a.C=0;a.P=0;a.G=null;a.D=null;a.A=null;a.L=0;a.R=!1;a.N=!1;return a}var T=AMP.BaseElement;S.prototype=h(T.prototype);S.prototype.constructor=S;if(r)r(S,T);else for(var U in T)if("prototype"!=U)if(Object.defineProperties){var V=Object.getOwnPropertyDescriptor(T,U);V&&Object.defineProperty(S,U,V)}else S[U]=T[U];S.Z=T.prototype;
S.prototype.buildCallback=function(){var a=E(this.getAmpDoc(),"viewer");a.whenFirstVisible().then(this.V.bind(this));this.R=this.element.hasAttribute("once")};S.prototype.V=function(){var a=this;aa(this);this.w=w(this.element);this.l||(R(this.getAmpDoc()),this.l=E(this.getAmpDoc(),"position-observer"));this.getAmpDoc().whenReady().then(function(){var b=W(a);a.l.observe(b,1,a.W.bind(a))})};
function X(a,b){var d=L(a.win,"amp-position-observer.scroll",F({percent:a.L}));d.additionalViewportData={"top-ratio":a.m,"bottom-ratio":a.j,"top-margin":b.top,"bottom-margin":b.bottom};a.w.trigger(a.element,"scroll",d,1)}
S.prototype.W=function(a){if(!this.R||!this.N){var b=this.h,d=this.G&&this.G.height,c=a;this.A||(this.A=c.viewportRect.height);var e=this.A-c.viewportRect.height,g=0;150>Math.abs(e)?g=e:this.A=null;c.viewportRect=G(c.viewportRect.left,c.viewportRect.top,c.viewportRect.width,c.viewportRect.height+g);this.G=a.viewportRect;d!=a.viewportRect.height&&(this.C=Y(this,this.M),this.P=Y(this,this.H));c=a.viewportRect;var f=c=G(c.left,c.top+this.C,c.width,c.height-this.P-this.C);c=a.positionRect;if(c){var n=
H(c,f);e=f;g=n;if("inside"==g)this.h=!0;else{var k=c.height*("top"==g?this.m:this.j);this.h="bottom"==g?c.top<=e.bottom-k:c.bottom>=e.top+k}}else this.h=!1,n=a.relativePos;b&&!this.h&&(this.L="bottom"==n?0:1,X(this,f),e=L(this.win,"amp-position-observer.exit",F({})),this.w.trigger(this.element,"exit",e,1),this.N=!0);!b&&this.h&&(e=L(this.win,"amp-position-observer.enter",F({})),this.w.trigger(this.element,"enter",e,1));this.h&&(e=f,c&&(this.L=Math.abs(c.top-this.C-(e.height-c.height*this.j))/(e.height+
c.height-(c.height*this.j+c.height*this.m))),X(this,f))}};function aa(a){var b=a.element.getAttribute("intersection-ratios");if(b){var d=b.trim().split(" ");a.m=Z(d[0]);a.j=a.m;d[1]&&(a.j=Z(d[1]))}var c=a.element.getAttribute("viewport-margins");c&&(c=c.trim().split(" "),a.M=c[0],a.H=a.M,c[1]&&(a.H=c[1]));a.D=a.element.getAttribute("target")}
function W(a){var b=a.D?u().assertElement(a.getAmpDoc().getElementById(a.D),"No element found with id:"+a.D):a.element.parentNode;a.getAmpDoc().getBody()==b&&(b=a.win.document.documentElement);return b}
function Y(a,b){b="number"==typeof b?b+"px":b&&/^\d+(\.\d+)?(px|em|rem|vh|vw|vmin|vmax|cm|mm|q|in|pc|pt)?$/.test(b)?/^\d+(\.\d+)?$/.test(b)?b+"px":b:void 0;b=K(b);var d=b;K(d);d=v(d.match(/[a-z]+/i),"Failed to read units from %s",d)[0];var c=parseFloat(b);c="number"===typeof c&&isFinite(c)?c:void 0;if(!c)return 0;v("px"==d||"vh"==d,"Only pixel or vh are valid as units for exclusion margins: "+b);"vh"==d&&(c=c/100*a.G.height);return c}
function Z(a){var b=parseFloat(a);v(0<=b&&1>=b,"Ratios must be a decimal between 0 and 1: "+a);return b}S.prototype.Y=function(){if(this.l){var a=W(this);this.l.unobserve(a);this.l=null}};(function(a){a.registerElement("amp-position-observer",S)})(self.AMP);
})});
//# sourceMappingURL=amp-position-observer-0.1.js.map

